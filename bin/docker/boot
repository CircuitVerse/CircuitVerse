#!/bin/bash

# Delete server.pid if it exists
rm -f /circuitverse/tmp/pids/server.pid 2>&1

# Run setup
echo "Setup project"
./bin/docker/setup

if [[ "$OPERATING_SYSTEM" == "linux" ]]; then
  if [ ! -d "${HOST_CURRENT_DIRECTORY%/*}" ]; then
    sudo mkdir -p "${HOST_CURRENT_DIRECTORY%/*}"
  fi
  # Setup symbolic link for solargraph
  if [ ! -L "$HOST_CURRENT_DIRECTORY" ]; then
    sudo ln -s -T /circuitverse "$HOST_CURRENT_DIRECTORY"
  fi
  # Start solargraph server in background
  bundle exec solargraph socket --host="0.0.0.0" --port=3002 &> /dev/null &
fi



# Start server
./bin/dev

# Start bash if previous command exits
/bin/bash