

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> testbench.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Classes</h3><ul><li><a href="CanvasGradient.html">CanvasGradient</a></li><li><a href="TestbenchData.html">TestbenchData</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addKeys">addKeys</a></li><li><a href="global.html#bindIO">bindIO</a></li><li><a href="global.html#buttonListenerFunctions">buttonListenerFunctions</a></li><li><a href="global.html#checkDistinctIdentifiersData">checkDistinctIdentifiersData</a></li><li><a href="global.html#checkDistinctIdentifiersScope">checkDistinctIdentifiersScope</a></li><li><a href="global.html#checkUpdate">checkUpdate</a></li><li><a href="global.html#colors">colors</a></li><li><a href="global.html#colorThemes">colorThemes</a></li><li><a href="global.html#CreateAbstraction">CreateAbstraction</a></li><li><a href="global.html#createElements">createElements</a></li><li><a href="global.html#createNewCircuitScope">createNewCircuitScope</a></li><li><a href="global.html#creatorOpenPrompt">creatorOpenPrompt</a></li><li><a href="global.html#ctx">ctx</a></li><li><a href="global.html#CustomColorThemes">CustomColorThemes</a></li><li><a href="global.html#customTheme">customTheme</a></li><li><a href="global.html#defaultKeys">defaultKeys</a></li><li><a href="global.html#ExportCircuitFiles">ExportCircuitFiles</a></li><li><a href="global.html#fillSubcircuitElements">fillSubcircuitElements</a></li><li><a href="global.html#frameInterval">frameInterval</a></li><li><a href="global.html#getCanvasColors">getCanvasColors</a></li><li><a href="global.html#getCustomThemeCard">getCustomThemeCard</a></li><li><a href="global.html#getOutputValues">getOutputValues</a></li><li><a href="global.html#getTabsOrder">getTabsOrder</a></li><li><a href="global.html#getThemeCard">getThemeCard</a></li><li><a href="global.html#getThemeCardSvg">getThemeCardSvg</a></li><li><a href="global.html#loadResult">loadResult</a></li><li><a href="global.html#modules">modules</a></li><li><a href="global.html#normalize">normalize</a></li><li><a href="global.html#openCreator">openCreator</a></li><li><a href="global.html#override">override</a></li><li><a href="global.html#readOnlyUI">readOnlyUI</a></li><li><a href="global.html#runAll">runAll</a></li><li><a href="global.html#runSingleCombinational">runSingleCombinational</a></li><li><a href="global.html#runSingleSequential">runSingleSequential</a></li><li><a href="global.html#runSingleTest">runSingleTest</a></li><li><a href="global.html#runTestBench">runTestBench</a></li><li><a href="global.html#saveData">saveData</a></li><li><a href="global.html#setDefault">setDefault</a></li><li><a href="global.html#setInputValues">setInputValues</a></li><li><a href="global.html#setUICurrentCase">setUICurrentCase</a></li><li><a href="global.html#setUIResult">setUIResult</a></li><li><a href="global.html#setUITableHeaders">setUITableHeaders</a></li><li><a href="global.html#setupTestbenchUI">setupTestbenchUI</a></li><li><a href="global.html#setUserKeys">setUserKeys</a></li><li><a href="global.html#showValidationUI">showValidationUI</a></li><li><a href="global.html#solveBooleanFunction">solveBooleanFunction</a></li><li><a href="global.html#tickClock">tickClock</a></li><li><a href="global.html#triggerReset">triggerReset</a></li><li><a href="global.html#updateHTML">updateHTML</a></li><li><a href="global.html#updateTestbenchUI">updateTestbenchUI</a></li><li><a href="global.html#updateThemeForStyle">updateThemeForStyle</a></li><li><a href="global.html#validate">validate</a></li><li><a href="global.html#validateInputs">validateInputs</a></li><li><a href="global.html#validateOutputs">validateOutputs</a></li><li><a href="global.html#validationAutoFix">validationAutoFix</a></li><li><a href="global.html#warnOverride">warnOverride</a></li></ul></div><div class="category"><h2>circuit</h2><h3>Classes</h3><ul><li><a href="Scope.html">Scope</a></li></ul><h3>Global</h3><ul><li><a href="global.html#changeCircuitName">changeCircuitName</a></li><li><a href="global.html#deleteCurrentCircuit">deleteCurrentCircuit</a></li><li><a href="global.html#newCircuit">newCircuit</a></li><li><a href="global.html#switchCircuit">switchCircuit</a></li></ul></div><div class="category"><h2>circuitElement</h2><h3>Classes</h3><ul><li><a href="CircuitElement.html">CircuitElement</a></li></ul></div><div class="category"><h2>combinationalAnalysis</h2><h3>Global</h3><ul><li><a href="global.html#createBooleanPrompt">createBooleanPrompt</a></li><li><a href="global.html#createCombinationalAnalysisPrompt">createCombinationalAnalysisPrompt</a></li></ul></div><div class="category"><h2>data</h2><h3>Modules</h3><ul><li><a href="module-createSaveAsImgPrompt.html">createSaveAsImgPrompt</a></li><li><a href="module-load.html">load</a></li><li><a href="module-redo.html">redo</a></li><li><a href="module-save.html">save</a></li><li><a href="module-undo.html">undo</a></li></ul><h3>Global</h3><ul><li><a href="global.html#checkIfBackup">checkIfBackup</a></li><li><a href="global.html#checkToSave">checkToSave</a></li><li><a href="global.html#clearProject">clearProject</a></li><li><a href="global.html#downloadAsImg">downloadAsImg</a></li><li><a href="global.html#generateImage">generateImage</a></li><li><a href="global.html#generateImageForOnline">generateImageForOnline</a></li><li><a href="global.html#generateSaveData">generateSaveData</a></li><li><a href="global.html#getProjectName">getProjectName</a></li><li><a href="global.html#loadModule">loadModule</a></li><li><a href="global.html#loadScope">loadScope</a></li><li><a href="global.html#newProject">newProject</a></li><li><a href="global.html#openOffline">openOffline</a></li><li><a href="global.html#projectSaved">projectSaved</a></li><li><a href="global.html#recoverProject">recoverProject</a></li><li><a href="global.html#rectifyObjectType">rectifyObjectType</a></li><li><a href="global.html#removeBugNodes">removeBugNodes</a></li><li><a href="global.html#saveOffline">saveOffline</a></li><li><a href="global.html#setProjectName">setProjectName</a></li></ul></div><div class="category"><h2>engine</h2><h3>Global</h3><ul><li><a href="global.html#canvasMessageData">canvasMessageData</a></li><li><a href="global.html#changeLightMode">changeLightMode</a></li><li><a href="global.html#errorDetected">errorDetected</a></li><li><a href="global.html#errorDetectedGet">errorDetectedGet</a></li><li><a href="global.html#errorDetectedSet">errorDetectedSet</a></li><li><a href="global.html#forceResetNodes">forceResetNodes</a></li><li><a href="global.html#forceResetNodesSet">forceResetNodesSet</a></li><li><a href="global.html#gridUpdate">gridUpdate</a></li><li><a href="global.html#gridUpdateGet">gridUpdateGet</a></li><li><a href="global.html#gridUpdateSet">gridUpdateSet</a></li><li><a href="global.html#objectSelection">objectSelection</a></li><li><a href="global.html#objectSelectionSet">objectSelectionSet</a></li><li><a href="global.html#play">play</a></li><li><a href="global.html#renderCanvas">renderCanvas</a></li><li><a href="global.html#scheduleUpdate">scheduleUpdate</a></li><li><a href="global.html#update">update</a></li><li><a href="global.html#updateCanvas">updateCanvas</a></li><li><a href="global.html#updateCanvasSet">updateCanvasSet</a></li><li><a href="global.html#updatePosition">updatePosition</a></li><li><a href="global.html#updatePositionSet">updatePositionSet</a></li><li><a href="global.html#updateSelectionsAndPane">updateSelectionsAndPane</a></li><li><a href="global.html#updateSimulation">updateSimulation</a></li><li><a href="global.html#updateSimulationSet">updateSimulationSet</a></li><li><a href="global.html#updateSubcircuit">updateSubcircuit</a></li><li><a href="global.html#updateSubcircuitSet">updateSubcircuitSet</a></li><li><a href="global.html#willBeUpdated">willBeUpdated</a></li><li><a href="global.html#willBeUpdatedSet">willBeUpdatedSet</a></li><li><a href="global.html#wireToBeChecked">wireToBeChecked</a></li><li><a href="global.html#wireToBeCheckedSet">wireToBeCheckedSet</a></li></ul></div><div class="category"><h2>eventQueue</h2><h3>Classes</h3><ul><li><a href="EventQueue.html">EventQueue</a></li></ul></div><div class="category"><h2>events</h2><h3>Global</h3><ul><li><a href="global.html#copy">copy</a></li><li><a href="global.html#cut">cut</a></li><li><a href="global.html#paste">paste</a></li><li><a href="global.html#selectAll">selectAll</a></li></ul></div><div class="category"><h2>layout</h2><h3>Classes</h3><ul><li><a href="LayoutBuffer.html">LayoutBuffer</a></li><li><a href="LayoutNode.html">LayoutNode</a></li></ul></div><div class="category"><h2>layoutMode</h2><h3>Global</h3><ul><li><a href="global.html#cancelLayout">cancelLayout</a></li><li><a href="global.html#decreaseLayoutHeight">decreaseLayoutHeight</a></li><li><a href="global.html#decreaseLayoutWidth">decreaseLayoutWidth</a></li><li><a href="global.html#determineLabel">determineLabel</a></li><li><a href="global.html#increaseLayoutHeight">increaseLayoutHeight</a></li><li><a href="global.html#increaseLayoutWidth">increaseLayoutWidth</a></li><li><a href="global.html#layoutMode">layoutMode</a></li><li><a href="global.html#layoutResetNodes">layoutResetNodes</a></li><li><a href="global.html#layoutTitleDown">layoutTitleDown</a></li><li><a href="global.html#layoutTitleLeft">layoutTitleLeft</a></li><li><a href="global.html#layoutTitleRight">layoutTitleRight</a></li><li><a href="global.html#layoutTitleUp">layoutTitleUp</a></li><li><a href="global.html#layoutUpdate">layoutUpdate</a></li><li><a href="global.html#paneLayout">paneLayout</a></li><li><a href="global.html#renderLayout">renderLayout</a></li><li><a href="global.html#saveLayout">saveLayout</a></li><li><a href="global.html#tempBuffer">tempBuffer</a></li><li><a href="global.html#toggleLayoutMode">toggleLayoutMode</a></li><li><a href="global.html#toggleLayoutTitle">toggleLayoutTitle</a></li></ul></div><div class="category"><h2>minimap</h2><h3>Global</h3><ul><li><a href="global.html#miniMapArea">miniMapArea</a></li></ul></div><div class="category"><h2>modules</h2><h3>Classes</h3><ul><li><a href="Adder.html">Adder</a></li><li><a href="ALU.html">ALU</a></li><li><a href="AndGate.html">AndGate</a></li><li><a href="Arrow.html">Arrow</a></li><li><a href="BitSelector.html">BitSelector</a></li><li><a href="Buffer.html">Buffer</a></li><li><a href="Button.html">Button</a></li><li><a href="ConstantVal.html">ConstantVal</a></li><li><a href="ControlledInverter.html">ControlledInverter</a></li><li><a href="Counter.html">Counter</a></li><li><a href="Decoder.html">Decoder</a></li><li><a href="Demultiplexer.html">Demultiplexer</a></li><li><a href="DigitalLed.html">DigitalLed</a></li><li><a href="Flag.html">Flag</a></li><li><a href="Ground.html">Ground</a></li><li><a href="HexDisplay.html">HexDisplay</a></li><li><a href="Image.html">Image</a></li><li><a href="Input.html">Input</a></li><li><a href="LSB.html">LSB</a></li><li><a href="MSB.html">MSB</a></li><li><a href="Multiplexer.html">Multiplexer</a></li><li><a href="NandGate.html">NandGate</a></li><li><a href="NorGate.html">NorGate</a></li><li><a href="NotGate.html">NotGate</a></li><li><a href="OrGate.html">OrGate</a></li><li><a href="Output.html">Output</a></li><li><a href="Power.html">Power</a></li><li><a href="PriorityEncoder.html">PriorityEncoder</a></li><li><a href="Rectangle.html">Rectangle</a></li><li><a href="RGBLed.html">RGBLed</a></li><li><a href="RGBLedMatrix.html">RGBLedMatrix</a></li><li><a href="SevenSegDisplay.html">SevenSegDisplay</a></li><li><a href="SixteenSegDisplay.html">SixteenSegDisplay</a></li><li><a href="Splitter.html">Splitter</a></li><li><a href="SquareRGBLed.html">SquareRGBLed</a></li><li><a href="Stepper.html">Stepper</a></li><li><a href="Text.html">Text</a></li><li><a href="TriState.html">TriState</a></li><li><a href="Tunnel.html">Tunnel</a></li><li><a href="TwoComplement.html">TwoComplement</a></li><li><a href="VariableLed.html">VariableLed</a></li><li><a href="verilogDivider.html">verilogDivider</a></li><li><a href="verilogMultiplier.html">verilogMultiplier</a></li><li><a href="verilogPower.html">verilogPower</a></li><li><a href="verilogShiftLeft.html">verilogShiftLeft</a></li><li><a href="verilogShiftRight.html">verilogShiftRight</a></li><li><a href="XnorGate.html">XnorGate</a></li><li><a href="XorGate.html">XorGate</a></li></ul></div><div class="category"><h2>node</h2><h3>Classes</h3><ul><li><a href="Node.html">Node</a></li></ul><h3>Global</h3><ul><li><a href="global.html#constructNodeConnections">constructNodeConnections</a></li><li><a href="global.html#extractNode">extractNode</a></li><li><a href="global.html#findNode">findNode</a></li><li><a href="global.html#loadNode">loadNode</a></li><li><a href="global.html#replace">replace</a></li><li><a href="global.html#uniqueIdCounter">uniqueIdCounter</a></li></ul></div><div class="category"><h2>plotArea</h2><h3>Global</h3><ul><li><a href="global.html#plotArea">plotArea</a></li></ul></div><div class="category"><h2>sequential</h2><h3>Classes</h3><ul><li><a href="Clock.html">Clock</a></li><li><a href="DflipFlop.html">DflipFlop</a></li><li><a href="EEPROM.html">EEPROM</a></li><li><a href="Rom.html">Rom</a></li><li><a href="TflipFlop.html">TflipFlop</a></li><li><a href="TTY.html">TTY</a></li></ul><h3>Global</h3><ul><li><a href="global.html#changeClockEnable">changeClockEnable</a></li><li><a href="global.html#runTest">runTest</a></li></ul></div><div class="category"><h2>setup</h2><h3>Global</h3><ul><li><a href="global.html#resetup">resetup</a></li><li><a href="global.html#setup">setup</a></li><li><a href="global.html#setupElementLists">setupElementLists</a></li><li><a href="global.html#setupEnvironment">setupEnvironment</a></li></ul></div><div class="category"><h2>simulationArea</h2><h3>Global</h3><ul><li><a href="global.html#simulationArea">simulationArea</a></li></ul></div><div class="category"><h2>subcircuit</h2><h3>Classes</h3><ul><li><a href="SubCircuit.html">SubCircuit</a></li></ul><h3>Global</h3><ul><li><a href="global.html#createSubCircuitPrompt">createSubCircuitPrompt</a></li><li><a href="global.html#loadSubCircuit">loadSubCircuit</a></li></ul></div><div class="category"><h2>testbench</h2><h3>Classes</h3><ul><li><a href="ForceGate.html">ForceGate</a></li><li><a href="TB_Input.html">TB_Input</a></li><li><a href="TB_Output.html">TB_Output</a></li></ul></div><div class="category"><h2>utils</h2><h3>Global</h3><ul><li><a href="global.html#showError">showError</a></li><li><a href="global.html#uniq">uniq</a></li></ul></div><div class="category"><h2>ux</h2><h3>Global</h3><ul><li><a href="global.html#ctxPos">ctxPos</a></li><li><a href="global.html#escapeHtml">escapeHtml</a></li><li><a href="global.html#hideContextMenu">hideContextMenu</a></li><li><a href="global.html#hideProperties">hideProperties</a></li><li><a href="global.html#menuItemClicked">menuItemClicked</a></li><li><a href="global.html#prevPropertyObj">prevPropertyObj</a></li><li><a href="global.html#setupUI">setupUI</a></li><li><a href="global.html#showContextMenu">showContextMenu</a></li><li><a href="global.html#showProperties">showProperties</a></li></ul></div><div class="category"><h2>wire</h2><h3>Classes</h3><ul><li><a href="module-wire.Wire.html">Wire</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>testbench.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * This file contains all functions related the the testbench
 * Contains the the testbench engine and UI modules
 */

import { scheduleBackup } from './data/backupCircuit';
import { changeClockEnable } from './sequential';
import { play } from './engine';
import Scope from './circuit';
import { showMessage, escapeHtml } from './utils';

/**
 * @typedef {number} RunContext
 */
const CONTEXT = {
    CONTEXT_SIMULATOR: 0,
    CONTEXT_ASSIGNMENTS: 1,
};

const VALIDATION_ERRORS = {
    NOTPRESENT: 0, // Element is not present in the circuit
    WRONGBITWIDTH: 1, // Element is present but has incorrect bitwidth
    DUPLICATE_ID_DATA: 2, // Duplicate identifiers in test data
    DUPLICATE_ID_SCOPE: 3, // Duplicate identifiers in scope
    NO_RST: 4, // Sequential circuit but no reset(RST) in scope
};

const TESTBENCH_CREATOR_PATH = '/testbench';

// Do we have any other function to do this?
// Utility function. Converts decimal number to binary string
function dec2bin(dec, bitWidth = undefined) {
    if (dec === undefined) return 'X';
    const bin = (dec >>> 0).toString(2);
    if (!bitWidth) return bin;

    return '0'.repeat(bitWidth - bin.length) + bin;
}

/**
 * Class to store all data related to the testbench and functions to use it
 * @param {Object} data - Javascript object of the test data
 * @param {number=} currentGroup - Current group index in the test
 * @param {number=} currentCase - Current case index in the group
 */
export class TestbenchData {
    constructor(data, currentGroup = 0, currentCase = 0) {
        this.currentCase = currentCase;
        this.currentGroup = currentGroup;
        this.testData = data;
    }

    /**
     * Checks whether given case-group pair exists in the test
     */
    isCaseValid() {
        if (this.currentGroup >= this.data.groups.length || this.currentGroup &lt; 0) return false;
        const caseCount = this.testData.groups[this.currentGroup].inputs[0].values.length;
        if (this.currentCase >= caseCount || this.currentCase &lt; 0) return false;

        return true;
    }

    /**
     * Validate and set case and group in the test
     * @param {number} groupIndex - Group index to set
     * @param {number} caseIndex -  Case index to set
     */
    setCase(groupIndex, caseIndex) {
        const newCase = new TestbenchData(this.testData, groupIndex, caseIndex);
        if (newCase.isCaseValid()) {
            this.currentGroup = groupIndex;
            this.currentCase = caseIndex;
            return true;
        }

        return false;
    }

    /**
     * Validate and go to the next group.
     * Skips over empty groups
     */
    groupNext() {
        const newCase = new TestbenchData(this.testData, this.currentGroup, 0);
        const groupCount = newCase.testData.groups.length;
        let caseCount = newCase.testData.groups[newCase.currentGroup].inputs[0].values.length;

        while (caseCount === 0 || this.currentGroup === newCase.currentGroup) {
            newCase.currentGroup++;
            if (newCase.currentGroup >= groupCount) return false;
            caseCount = newCase.testData.groups[newCase.currentGroup].inputs[0].values.length;
        }

        this.currentGroup = newCase.currentGroup;
        this.currentCase = newCase.currentCase;
        return true;
    }

    /**
     * Validate and go to the previous group.
     * Skips over empty groups
     */
    groupPrev() {
        const newCase = new TestbenchData(this.testData, this.currentGroup, 0);
        const groupCount = newCase.testData.groups.length;
        let caseCount = newCase.testData.groups[newCase.currentGroup].inputs[0].values.length;

        while (caseCount === 0 || this.currentGroup === newCase.currentGroup) {
            newCase.currentGroup--;
            if (newCase.currentGroup &lt; 0) return false;
            caseCount = newCase.testData.groups[newCase.currentGroup].inputs[0].values.length;
        }

        this.currentGroup = newCase.currentGroup;
        this.currentCase = newCase.currentCase;
        return true;
    }

    /**
     * Validate and go to the next case
     */
    caseNext() {
        const caseCount = this.testData.groups[this.currentGroup].inputs[0].values.length;
        if (this.currentCase >= caseCount - 1) return this.groupNext();
        this.currentCase++;
        return true;
    }

    /**
     * Validate and go to the previous case
     */
    casePrev() {
        if (this.currentCase &lt;= 0) {
            if (!this.groupPrev()) return false;
            const caseCount = this.testData.groups[this.currentGroup].inputs[0].values.length;
            this.currentCase = caseCount - 1;
            return true;
        }

        this.currentCase--;
        return true;
    }

    /**
     * Finds and switches to the first non empty group to start the test from
     */
    goToFirstValidGroup() {
        const newCase = new TestbenchData(this.testData, 0, 0);
        const caseCount = newCase.testData.groups[this.currentGroup].inputs[0].values.length;

        // If the first group is not empty, do nothing
        if (caseCount > 0) return true;

        // Otherwise go next until non empty group
        const validExists = newCase.groupNext();

        // If all groups empty return false
        if (!validExists) return false;

        // else set case to the non empty group
        this.currentGroup = newCase.currentGroup;
        this.currentCase = newCase.currentCase;
        return true;
    }
}

/**
 * UI Function
 * Create prompt for the testbench UI when creator is opened
 */
function creatorOpenPrompt(creatorWindow) {
    scheduleBackup();
    const windowSVG = `
    &lt;svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="white" class="bi bi-window" viewBox="0 0 16 16">
      &lt;path d="M2.5 4a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1zm2-.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zm1 .5a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"/>
      &lt;path d="M2 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2H2zm13 2v2H1V3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1zM2 14a1 1 0 0 1-1-1V6h14v7a1 1 0 0 1-1 1H2z"/>
    &lt;/svg>
    `;

    const s = `
    &lt;div style="text-align: center;">
        &lt;div style="margin: 20px;">
            ${windowSVG}
        &lt;/div>
        &lt;p>A browser pop-up is opened to create the test&lt;/p>
        &lt;p>Please save the test to open it here&lt;/p>
    &lt;/div>
    `;

    $('#setTestbenchData').dialog({
        resizable: false,
        width: 'auto',
        buttons: [
            {
                text: 'Close Pop-Up',
                click() {
                    $(this).dialog('close');
                    creatorWindow.close();
                },
            },
        ],
    });

    $('#setTestbenchData').empty();
    $('#setTestbenchData').append(s);
}

/**
 * Interface function to run testbench. Called by testbench prompt on simulator or assignments
 * @param {Object} data - Object containing Test Data
 * @param {RunContext=} runContext - Whether simulator or Assignment called this function
 * @param {Scope=} scope - the circuit
 */
export function runTestBench(data, scope = globalScope, runContext = CONTEXT.CONTEXT_SIMULATOR) {
    const isValid = validate(data, scope);
    if (!isValid.ok) {
        showMessage('Testbench: Some elements missing from circuit. Click Validate to know more');
    }

    if (runContext === CONTEXT.CONTEXT_SIMULATOR) {
        const tempTestbenchData = new TestbenchData(data);
        if (!tempTestbenchData.goToFirstValidGroup()) {
            showMessage('Testbench: The test is empty');
            return;
        }

        globalScope.testbenchData = tempTestbenchData;

        updateTestbenchUI();
        return;
    }

    if (runContext === CONTEXT.CONTEXT_ASSIGNMENTS) {
        // Not implemented

    }
}

/**
 * Updates the TestBench UI on the simulator with the current test attached
 * If no test is attached then shows the 'No test attached' screen
 * Called by runTestBench() when test is set, also called by UX/setupPanelListeners()
 * whenever ux change requires this UI to update(such as clicking on a different circuit or
 * loading a saved circuit)
 */
export function updateTestbenchUI() {
    // Remove all listeners from buttons
    $('.tb-dialog-button').off('click');
    $('.tb-case-button').off('click');

    setupTestbenchUI();
    if (globalScope.testbenchData != undefined) {
        const { testbenchData } = globalScope;

        // Initialize the UI
        setUITableHeaders(testbenchData);

        // Add listeners to buttons
        $('.tb-case-button#prev-case-btn').on('click', buttonListenerFunctions.previousCaseButton);
        $('.tb-case-button#next-case-btn').on('click', buttonListenerFunctions.nextCaseButton);
        $('.tb-case-button#prev-group-btn').on('click', buttonListenerFunctions.previousGroupButton);
        $('.tb-case-button#next-group-btn').on('click', buttonListenerFunctions.nextGroupButton);
        $('.tb-dialog-button#change-test-btn').on('click', buttonListenerFunctions.changeTestButton);
        $('.tb-dialog-button#runall-btn').on('click', buttonListenerFunctions.runAllButton);
        $('.tb-dialog-button#edit-test-btn').on('click', buttonListenerFunctions.editTestButton);
        $('.tb-dialog-button#validate-btn').on('click', buttonListenerFunctions.validateButton);
        $('.tb-dialog-button#remove-test-btn').on('click', buttonListenerFunctions.removeTestButton);
    }

    // Add listener to attach test button
    $('.tb-dialog-button#attach-test-btn').on('click', buttonListenerFunctions.attachTestButton);
}

/**
 * Defines all the functions called as event listeners for buttons on the UI
 */
const buttonListenerFunctions = {

    previousCaseButton: () => {
        const isValid = validate(globalScope.testbenchData.testData, globalScope);
        if (!isValid.ok) {
            showMessage('Testbench: Some elements missing from circuit. Click Validate to know more');
            return;
        }
        globalScope.testbenchData.casePrev();
        buttonListenerFunctions.computeCase();
    },

    nextCaseButton: () => {
        const isValid = validate(globalScope.testbenchData.testData, globalScope);
        if (!isValid.ok) {
            showMessage('Testbench: Some elements missing from circuit. Click Validate to know more');
            return;
        }
        globalScope.testbenchData.caseNext();
        buttonListenerFunctions.computeCase();
    },

    previousGroupButton: () => {
        const isValid = validate(globalScope.testbenchData.testData, globalScope);
        if (!isValid.ok) {
            showMessage('Testbench: Some elements missing from circuit. Click Validate to know more');
            return;
        }
        globalScope.testbenchData.groupPrev();
        buttonListenerFunctions.computeCase();
    },

    nextGroupButton: () => {
        const isValid = validate(globalScope.testbenchData.testData, globalScope);
        if (!isValid.ok) {
            showMessage('Testbench: Some elements missing from circuit. Click Validate to know more');
            return;
        }
        globalScope.testbenchData.groupNext();
        buttonListenerFunctions.computeCase();
    },

    changeTestButton: () => {
        openCreator('create');
    },

    runAllButton: () => {
        const isValid = validate(globalScope.testbenchData.testData, globalScope);
        if (!isValid.ok) {
            showMessage('Testbench: Some elements missing from circuit. Click Validate to know more');
            return;
        }
        const results = runAll(globalScope.testbenchData.testData, globalScope);
        const { passed } = results.summary;
        const { total } = results.summary;
        const resultString = JSON.stringify(results.detailed);
        $('#runall-summary').text(`${passed} out of ${total}`);
        $('#runall-detailed-link').on('click', () => { openCreator('result', resultString); });
        $('.testbench-runall-label').css('display', 'table-cell');
        $('.testbench-runall-label').delay(5000).fadeOut('slow');
    },

    editTestButton: () => {
        const editDataString = JSON.stringify(globalScope.testbenchData.testData);
        openCreator('edit', editDataString);
    },

    validateButton: () => {
        const isValid = validate(globalScope.testbenchData.testData, globalScope);
        showValidationUI(isValid);
    },

    removeTestButton: () => {
        if (confirm('Are you sure you want to remove the test from the circuit?')) {
            globalScope.testbenchData = undefined;
            setupTestbenchUI();
        }
    },

    attachTestButton: () => {
        openCreator('create');
    },

    rerunTestButton: () => {
        buttonListenerFunctions.computeCase();
    },

    computeCase: () => {
        setUICurrentCase(globalScope.testbenchData);
        const result = runSingleTest(globalScope.testbenchData, globalScope);
        setUIResult(globalScope.testbenchData, result);
    },
};

/**
 * UI Function
 * Checks whether test is attached to the scope and switches UI accordingly
 */
export function setupTestbenchUI() {
    // Don't change UI if UI is minimized (because hide() and show() are recursive)
    if ($('.testbench-manual-panel .minimize').css('display') === 'none') return;

    if (globalScope.testbenchData === undefined) {
        $('.tb-test-not-null').hide();
        $('.tb-test-null').show();
        return;
    }

    $('.tb-test-null').hide();
    $('.tb-test-not-null').show();
}

/**
 * Run all the tests automatically. Called by runTestBench()
 * @param {Object} data - Object containing Test Data
 * @param {Scope=} scope - the circuit
 */
export function runAll(data, scope = globalScope) {
    // Stop the clocks
    // TestBench will now take over clock toggling
    changeClockEnable(false);

    const { inputs, outputs, reset } = bindIO(data, scope);
    let totalCases = 0;
    let passedCases = 0;

    data.groups.forEach((group) => {
        // for (const output of group.outputs) output.results = [];
        group.outputs.forEach((output) => output.results = []);
        for (let case_i = 0; case_i &lt; group.n; case_i++) {
            totalCases++;
            // Set and propagate the inputs
            setInputValues(inputs, group, case_i, scope);
            // If sequential, trigger clock now
            if (data.type === 'seq') tickClock(scope);
            // Get output values
            const caseResult = getOutputValues(data, outputs);
            // Put the results in the data

            let casePassed = true; // Tracks if current case passed or failed

            caseResult.forEach((_, outName) => {
                // TODO: find() is not the best idea because of O(n)
                const output = group.outputs.find((dataOutput) => dataOutput.label === outName);
                output.results.push(caseResult.get(outName));

                if (output.values[case_i] !== caseResult.get(outName)) casePassed = false;
            });

            // If current case passed, then increment passedCases
            if (casePassed) passedCases++;
        }

        // If sequential, trigger reset at the end of group (set)
        if (data.type === 'seq') triggerReset(reset);
    });

    // Tests done, restart the clocks
    changeClockEnable(true);

    // Return results
    const results = {};
    results.detailed = data;
    results.summary = { passed: passedCases, total: totalCases };
    // console.log(JSON.stringify(results.detailed));
    return results;
}

/**
 * Runs single test
 * @param {Object} data - Object containing Test Data
 * @param {number} groupIndex - Index of the group to be tested
 * @param {number} caseIndex - Index of the case inside the group
 * @param {Scope} scope - The circuit
 */
function runSingleTest(testbenchData, scope) {
    const data = testbenchData.testData;

    let result;
    if (data.type === 'comb') {
        result = runSingleCombinational(testbenchData, scope);
    } else if (data.type === 'seq') {
        result = runSingleSequential(testbenchData, scope);
    }

    return result;
}

/**
 * Runs single combinational test
 * @param {Object} data - Object containing Test Data
 * @param {number} groupIndex - Index of the group to be tested
 * @param {number} caseIndex - Index of the case inside the group
 * @param {Scope} scope - The circuit
 */
function runSingleCombinational(testbenchData, scope) {
    const data = testbenchData.testData;
    const groupIndex = testbenchData.currentGroup;
    const caseIndex = testbenchData.currentCase;

    const { inputs, outputs } = bindIO(data, scope);
    const group = data.groups[groupIndex];

    // Stop the clocks
    changeClockEnable(false);

    // Set input values according to the test
    setInputValues(inputs, group, caseIndex, scope);
    // Check output values
    const result = getOutputValues(data, outputs);
    // Restart the clocks
    changeClockEnable(true);
    return result;
}

/**
 * Runs single sequential test and all tests above it in the group
 * Used in MANUAL mode
 * @param {Object} data - Object containing Test Data
 * @param {number} groupIndex - Index of the group to be tested
 * @param {number} caseIndex - Index of the case inside the group
 * @param {Scope} scope - The circuit
 */
function runSingleSequential(testbenchData, scope) {
    const data = testbenchData.testData;
    const groupIndex = testbenchData.currentGroup;
    const caseIndex = testbenchData.currentCase;

    const { inputs, outputs, reset } = bindIO(data, scope);
    const group = data.groups[groupIndex];

    // Stop the clocks
    changeClockEnable(false);

    // Trigger reset
    triggerReset(reset, scope);

    // Run the test and tests above in the same group
    for (let case_i = 0; case_i &lt;= caseIndex; case_i++) {
        setInputValues(inputs, group, case_i, scope);
        tickClock(scope);
    }

    const result = getOutputValues(data, outputs);

    // Restart the clocks
    changeClockEnable(true);

    return result;
}

/**
 * Set and propogate the input values according to the testcase.
 * Called by runSingle() and runAll()
 * @param {Object} inputs - Object with keys as input names and values as inputs
 * @param {Object} group - Test group
 * @param {number} caseIndex - Index of the case in the group
 * @param {Scope} scope - the circuit
 */
function setInputValues(inputs, group, caseIndex, scope) {
    group.inputs.forEach((input) => {
        inputs[input.label].state = parseInt(input.values[caseIndex], 2);
    });

    // Propagate inputs
    play(scope);
}

/**
 * Gets Output values as a Map with keys as output name and value as output state
 * @param {Object} outputs - Object with keys as output names and values as outputs
 */
function getOutputValues(data, outputs) {
    const values = new Map();

    data.groups[0].outputs.forEach((dataOutput) => {
        // Using node value because output state only changes on rendering
        const resultValue = outputs[dataOutput.label].nodeList[0].value;
        const resultBW = outputs[dataOutput.label].nodeList[0].bitWidth;
        values.set(dataOutput.label, dec2bin(resultValue, resultBW));
    });

    return values;
}

/**
 * UI Function
 * Shows validation UI
 * @param {Object} validationErrors - Object with errors returned by validate()
 */
function showValidationUI(validationErrors) {
    const checkSVG = `
    &lt;svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="white" class="bi bi-check" viewBox="0 0 16 16">
      &lt;path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
    &lt;/svg>
    `;

    let s = `
    &lt;div style="text-align: center; color: white;">
        &lt;div style="margin: 20px;">
            ${checkSVG}
        &lt;/div>
        All good. No validation errors
    &lt;/div>
    `;

    if (!validationErrors.ok) {
        s = `
        &lt;div style="text-align: center; color: white;">
            &lt;p>Please fix these errors to run tests&lt;/p>
            &lt;table class="validation-ui-table">
                &lt;tr>
                    &lt;th>&lt;b>Identifier&lt;/b>&lt;/th>
                    &lt;th>&lt;b>Error&lt;/b>&lt;/th>
                &lt;/tr>
        `;

        validationErrors.invalids.forEach((vError) => {
            s += `
                &lt;tr>
                    &lt;td>${vError.identifier}&lt;/td>
                    &lt;td>${vError.message}&lt;/td>
                &lt;/tr>
            `;
        });

        s += '&lt;/table>&lt;/div>';
    }

    $('#testbenchValidate').dialog({
        resizable: false,
        width: 'auto',
        buttons: [
            {
                text: 'Ok',
                click() {
                    $(this).dialog('close');
                },
            },
            {
                text: 'Auto Fix',
                click() {
                    const fixes = validationAutoFix(validationErrors);
                    showMessage(`Testbench: Auto fixed ${fixes} errors`);
                    $(this).dialog('close');
                },
            },
        ],
    });

    $('#testbenchValidate').empty();
    $('#testbenchValidate').append(s);
}

/**
 * Validate if all inputs and output elements are present with correct bitwidths
 * @param {Object} data - Object containing Test Data
 * @param {Scope} scope - the circuit
 */
function validate(data, scope) {
    let invalids = [];

    // Check for duplicate identifiers
    if (!checkDistinctIdentifiersData(data)) {
        invalids.push({
            type: VALIDATION_ERRORS.DUPLICATE_ID_DATA,
            identifier: '-',
            message: 'Duplicate identifiers in test data',
        });
    }

    if (!checkDistinctIdentifiersScope(scope)) {
        invalids.push({
            type: VALIDATION_ERRORS.DUPLICATE_ID_SCOPE,
            identifier: '-',
            message: 'Duplicate identifiers in circuit',
        });
    }

    // Don't do further checks if duplicates
    if (invalids.length > 0) return { ok: false, invalids };

    // Validate inputs and outputs
    const inputsValid = validateInputs(data, scope);
    const outputsValid = validateOutputs(data, scope);

    invalids = inputsValid.ok ? invalids : invalids.concat(inputsValid.invalids);
    invalids = outputsValid.ok ? invalids : invalids.concat(outputsValid.invalids);

    // Validate presence of reset if test is sequential
    if (data.type === 'seq') {
        const resetPresent = scope.Input.some((simulatorReset) => (
            simulatorReset.label === 'RST'
                &amp;&amp; simulatorReset.bitWidth === 1
                &amp;&amp; simulatorReset.objectType === 'Input'
        ));

        if (!resetPresent) {
            invalids.push({
                type: VALIDATION_ERRORS.NO_RST,
                identifier: 'RST',
                message: 'Reset(RST) not present in circuit',
            });
        }
    }

    if (invalids.length > 0) return { ok: false, invalids };
    return { ok: true };
}

/**
 * Autofix whatever is possible in validation errors.
 * returns number of autofixed errors
 * @param {Object} validationErrors - Object with errors returned by validate()
 */
function validationAutoFix(validationErrors) {
    // Currently only autofixes bitwidths
    let fixedErrors = 0;
    // Return if no errors
    if (validationErrors.ok) return fixedErrors;

    const bitwidthErrors = validationErrors.invalids.filter((vError) => vError.type === VALIDATION_ERRORS.WRONGBITWIDTH);

    bitwidthErrors.forEach((bwError) => {
        const { element, expectedBitWidth } = bwError.extraInfo;
        element.newBitWidth(expectedBitWidth);
        fixedErrors++;
    });

    return fixedErrors;
}

/**
 * Checks if all the labels in the test data are unique. Called by validate()
 * @param {Object} data - Object containing Test Data
 */
function checkDistinctIdentifiersData(data) {
    const inputIdentifiersData = data.groups[0].inputs.map((input) => input.label);
    const outputIdentifiersData = data.groups[0].outputs.map((output) => output.label);
    const identifiersData = inputIdentifiersData.concat(outputIdentifiersData);

    return (new Set(identifiersData)).size === identifiersData.length;
}

/**
 * Checks if all the input/output labels in the scope are unique. Called by validate()
 * TODO: Replace with identifiers
 * @param {Scope} scope - the circuit
 */
function checkDistinctIdentifiersScope(scope) {
    const inputIdentifiersScope = scope.Input.map((input) => input.label);
    const outputIdentifiersScope = scope.Output.map((output) => output.label);
    let identifiersScope = inputIdentifiersScope.concat(outputIdentifiersScope);

    // Remove identifiers which have not been set yet (ie. empty strings)
    identifiersScope = identifiersScope.filter((identifer) => identifer != '');

    return (new Set(identifiersScope)).size === identifiersScope.length;
}

/**
 * Validates presence and bitwidths of test inputs in the circuit.
 * Called by validate()
 * @param {Object} data - Object containing Test Data
 * @param {Scope} scope - the circuit
 */
function validateInputs(data, scope) {
    const invalids = [];

    data.groups[0].inputs.forEach((dataInput) => {
        const matchInput = scope.Input.find((simulatorInput) => simulatorInput.label === dataInput.label);

        if (matchInput === undefined) {
            invalids.push({
                type: VALIDATION_ERRORS.NOTPRESENT,
                identifier: dataInput.label,
                message: 'Input is not present in the circuit',
            });
        } else if (matchInput.bitWidth !== dataInput.bitWidth) {
            invalids.push({
                type: VALIDATION_ERRORS.WRONGBITWIDTH,
                identifier: dataInput.label,
                extraInfo: {
                    element: matchInput,
                    expectedBitWidth: dataInput.bitWidth,
                },
                message: `Input bitwidths don't match in circuit and test (${matchInput.bitWidth} vs ${dataInput.bitWidth})`,
            });
        }
    });

    if (invalids.length > 0) return { ok: false, invalids };
    return { ok: true };
}

/**
 * Validates presence and bitwidths of test outputs in the circuit.
 * Called by validate()
 * @param {Object} data - Object containing Test Data
 * @param {Scope} scope - the circuit
 */
function validateOutputs(data, scope) {
    const invalids = [];

    data.groups[0].outputs.forEach((dataOutput) => {
        const matchOutput = scope.Output.find((simulatorOutput) => simulatorOutput.label === dataOutput.label);

        if (matchOutput === undefined) {
            invalids.push({
                type: VALIDATION_ERRORS.NOTPRESENT,
                identifier: dataOutput.label,
                message: 'Output is not present in the circuit',
            });
        } else if (matchOutput.bitWidth !== dataOutput.bitWidth) {
            invalids.push({
                type: VALIDATION_ERRORS.WRONGBITWIDTH,
                identifier: dataOutput.label,
                extraInfo: {
                    element: matchOutput,
                    expectedBitWidth: dataOutput.bitWidth,
                },
                message: `Output bitwidths don't match in circuit and test (${matchOutput.bitWidth} vs ${dataOutput.bitWidth})`,
            });
        }
    });

    if (invalids.length > 0) return { ok: false, invalids };
    return { ok: true };
}

/**
 * Returns object of scope inputs and outputs keyed by their labels
 * @param {Object} data - Object containing Test Data
 * @param {Scope=} scope - the circuit
 */
function bindIO(data, scope) {
    const inputs = {};
    const outputs = {};
    let reset;

    data.groups[0].inputs.forEach((dataInput) => {
        inputs[dataInput.label] = scope.Input.find((simulatorInput) => simulatorInput.label === dataInput.label);
    });

    data.groups[0].outputs.forEach((dataOutput) => {
        outputs[dataOutput.label] = scope.Output.find((simulatorOutput) => simulatorOutput.label === dataOutput.label);
    });

    if (data.type === 'seq') {
        reset = scope.Input.find((simulatorOutput) => simulatorOutput.label === 'RST');
    }

    return { inputs, outputs, reset };
}

/**
 * Ticks clock recursively one full cycle (Only used in testbench context)
 * @param {Scope} scope - the circuit whose clock to be ticked
 */
function tickClock(scope) {
    scope.clockTick();
    play(scope);
    scope.clockTick();
    play(scope);
}

/**
 * Triggers reset (Only used in testbench context)
 * @param {Input} reset - reset pin to be triggered
 * @param {Scope} scope - the circuit
 */
function triggerReset(reset, scope) {
    reset.state = 1;
    play(scope);
    reset.state = 0;
    play(scope);
}

/**
 * UI Function
 * Sets IO labels and bitwidths on UI table
 * Called by simulatorRunTestbench()
 * @param {Object} data - Object containing the test data
 */
function setUITableHeaders(testbenchData) {
    const data = testbenchData.testData;
    const inputCount = data.groups[0].inputs.length;
    const outputCount = data.groups[0].outputs.length;

    $('#tb-manual-table-inputs-head').attr('colspan', inputCount);
    $('#tb-manual-table-outputs-head').attr('colspan', outputCount);

    $('.testbench-runall-label').css('display', 'none');

    $('.tb-data#data-title').children().eq(1).text(data.title || 'Untitled');
    $('.tb-data#data-type').children().eq(1).text(data.type === 'comb' ? 'Combinational' : 'Sequential');

    $('#tb-manual-table-labels').html('&lt;th>LABELS&lt;/th>');
    $('#tb-manual-table-bitwidths').html('&lt;td>Bitwidth&lt;/td>');

    data.groups[0].inputs.concat(data.groups[0].outputs).forEach((io) => {
        const label = `&lt;th>${escapeHtml(io.label)}&lt;/th>`;
        const bw = `&lt;td>${escapeHtml(io.bitWidth.toString())}&lt;/td>`;
        $('#tb-manual-table-labels').append(label);
        $('#tb-manual-table-bitwidths').append(bw);
    });

    setUICurrentCase(testbenchData);
}

/**
 * UI Function
 * Set current test case data on the UI
 * @param {Object} data - Object containing the test data
 * @param {number} groupIndex - Index of the group of current case
 * @param {number} caseIndex - Index of the case within the group
 */
function setUICurrentCase(testbenchData) {
    const data = testbenchData.testData;
    const groupIndex = testbenchData.currentGroup;
    const caseIndex = testbenchData.currentCase;

    const currCaseElement = $('#tb-manual-table-current-case');
    currCaseElement.empty();
    currCaseElement.append('&lt;td>Current Case&lt;/td>');
    $('#tb-manual-table-test-result').empty();
    $('#tb-manual-table-test-result').append('&lt;td>Result&lt;/td>');

    data.groups[groupIndex].inputs.forEach((input) => {
        currCaseElement.append(`&lt;td>${escapeHtml(input.values[caseIndex])}&lt;/td>`);
    });

    data.groups[groupIndex].outputs.forEach((output) => {
        currCaseElement.append(`&lt;td>${escapeHtml(output.values[caseIndex])}&lt;/td>`);
    });

    $('.testbench-manual-panel .group-label').text(data.groups[groupIndex].label);
    $('.testbench-manual-panel .case-label').text(caseIndex + 1);
}

/**
 * UI Function
 * Set the current test case result on the UI
 * @param {Object} data - Object containing the test data
 * @param {Map} result - Map containing the output values (returned by getOutputValues())
 */
function setUIResult(testbenchData, result) {
    const data = testbenchData.testData;
    const groupIndex = testbenchData.currentGroup;
    const caseIndex = testbenchData.currentCase;
    const resultElement = $('#tb-manual-table-test-result');
    let inputCount = data.groups[0].inputs.length;
    resultElement.empty();
    resultElement.append('&lt;td>Result&lt;/td>');
    while (inputCount--) {
        resultElement.append('&lt;td> - &lt;/td>');
    }

    for (const output of result.keys()) {
        const resultValue = result.get(output);
        const expectedValue = data.groups[groupIndex].outputs.find((dataOutput) => dataOutput.label === output).values[caseIndex];
        const color = resultValue === expectedValue ? '#17FC12' : '#FF1616';
        resultElement.append(`&lt;td style="color: ${color}">${escapeHtml(resultValue)}&lt;/td>`);
    }
}

/**
 * Use this function to navigate to test creator. This function starts the storage listener
 * so the test is loaded directly into the simulator
 * @param {string} type - 'create', 'edit' or 'result'
 * @param {String} dataString - data in JSON string to load in case of 'edit' and 'result'
 */
function openCreator(type, dataString) {
    const popupHeight = 800;
    const popupWidth = 1200;
    const popupTop = (window.height - popupHeight) / 2;
    const popupLeft = (window.width - popupWidth) / 2;
    const POPUP_STYLE_STRING = `height=${popupHeight},width=${popupWidth},top=${popupTop},left=${popupLeft}`;
    let popUp;

    /* Listener to catch testData from pop up and load it onto the testbench */
    const dataListener = (message) => {
        if (message.origin !== window.origin || message.data.type !== 'testData') return;

        // Check if the current scope requested the creator pop up
        const data = JSON.parse(message.data.data);

        // Unbind event listener
        window.removeEventListener('message', dataListener);

        // If scopeID does not match, do nothing and return
        if (data.scopeID != globalScope.id) return;

        // Load test data onto the scope
        runTestBench(data.testData, globalScope, CONTEXT.CONTEXT_SIMULATOR);

        // Close the 'Pop up is open' dialog
        $('#setTestbenchData').dialog('close');
    };

    if (type === 'create') {
        const url = `${TESTBENCH_CREATOR_PATH}?scopeID=${globalScope.id}&amp;popUp=true`;
        popUp = window.open(url, 'popupWindow', POPUP_STYLE_STRING);
        creatorOpenPrompt(popUp);
        window.addEventListener('message', dataListener);
    }

    if (type === 'edit') {
        const url = `${TESTBENCH_CREATOR_PATH}?scopeID=${globalScope.id}&amp;data=${dataString}&amp;popUp=true`;
        popUp = window.open(url, 'popupWindow', POPUP_STYLE_STRING);
        creatorOpenPrompt(popUp);
        window.addEventListener('message', dataListener);
    }

    if (type === 'result') {
        const url = `${TESTBENCH_CREATOR_PATH}?scopeID=${globalScope.id}&amp;result=${dataString}&amp;popUp=true`;
        popUp = window.open(url, 'popupWindow', POPUP_STYLE_STRING);
    }

    // Check if popup was closed (in case it was closed by window's X button),
    // then close 'popup open' dialog
    if (popUp &amp;&amp; type !== 'result') {
        const checkPopUp = setInterval(() => {
            if (popUp.closed) {
                // Close the dialog if it's open
                if ($('#setTestbenchData').dialog('isOpen')) $('#setTestbenchData').dialog('close');

                // Remove the event listener that listens for data from popup
                window.removeEventListener('message', dataListener);
                clearInterval(checkPopUp);
            }
        }, 1000);
    }
}
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
