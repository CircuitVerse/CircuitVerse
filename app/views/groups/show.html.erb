<link rel="stylesheet" type="text/css" href="/css/tooltip.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
.editlink {
  position: relative;
  top: -7px;
  left: 4px;
  border-radius:5px;
  background-color: #026e57	;
  border: none;
  color: white;
  padding: 8px 8px;
  font-size: 16px;
  cursor: pointer;
  
}
.editlink:hover {
  position: relative;
  top: -7px;
  left: 4px;
  border-radius:5px;
  background-color: #026e57	;
  border: none;
  color: white;
  padding: 8px 8px;
  font-size: 16px;
  cursor: pointer;
  text-decoration:none;
}
.addmem {
  position: absolute;
  right: 4px; 
  border-radius:15px;
  background-color: #42b983	;
  border: none;
  color: white;
  text-decoration:none;
  padding: 12px 34px;
  font-size: 16px;
  cursor: pointer;
  
}
.addmem:hover {
  position: absolute;
  right: 4px; 
  border-radius:15px;
  background-color: #42b983	;
  border: none;
  color: white;
  padding: 12px 34px;
  font-size: 16px;
  cursor: pointer;
  text-decoration:none;
}
.view {
  
  border-radius:5px;
  background-color: #42b983	;
  border: none;
  color: white;
  padding: 2px 12px;
  font-size: 16px;
  cursor: pointer;
  text-decoration:none;
  
}
.view:hover{
  text-decoration:none;
  color:white;
}
.EditReopen {
  
  border-radius:5px;
  background-color: #71cac8	;
  border: none;
  color: white;
  padding: 2px 12px;
  font-size: 16px;
  cursor: pointer;
  text-decoration:none;
  
}
.EditReopen:hover{
  text-decoration:none;
  color:white;
}
.del {
  
  border-radius:5px;
  background-color: #ff5959	;
  border: none;
  color: white;
  padding: 2px 12px;
  font-size: 16px;
  cursor: pointer;
  text-decoration:none;
  
}
.del:hover{
  text-decoration:none;
  color:white;
}
.arows{
  background-color:#f8fffc;
  border-color:solid #bcdbd3;
  
  
  

}
.row3:after {
  content: "";
  display: table;
  clear: both;
  overflow:hidden;
  
}
.column3 {
  float: left;
  width: 32.8%;
  padding: 10px;
  overflow:hidden;
  background-color:#f8fffc;
  border: 1px solid #bcdbd3;
  margin: 2px;
}
.memname{
  color:black;
  font-size:18px;
}
.memname:hover{
  color:black;
  font-size:18px;
  text-decoration:none;
}
.removerel{
  border-radius:5px;
  background-color: #ff5959	;
  border: none;
  color: white;
  padding: 2px 12px;
  font-size: 16px;
  cursor: pointer;
  text-decoration:none;
  position:relative;
  float:right;
  top:7px;
  overflow:hidden;

}
.removerel:hover{
  text-decoration:none;
  color:white;
}
.back {
  text-align:center;
  border-radius:15px;
  background-color: #42b983	;
  border: none;
  color: white;
  text-decoration:none;
  padding: 12px 34px;
  font-size: 16px;
  cursor: pointer;
  
}
.back:hover {
  text-align:center
  border-radius:15px;
  background-color: #42b983	;
  border: none;
  color: white;
  padding: 12px 34px;
  font-size: 16px;
  cursor: pointer;
  text-decoration:none;
}

</style>
<div class="container">
  <div class="row feature">
    <div class="col">
      <% if notice %>
        <p id="notice" class="alert alert-success"><%= notice %></p>
      <% end %>
      <p>
        <h1 style="text-align:center">
        <%= @group.name %>
        <%= link_to ' Edit Name', edit_group_path(@group), class:"editlink fa fa-pencil" %></h1>        
      </p>
      <p>
      <center style="font-size:25px">
        <strong>Mentor:</strong>
        <%= @group.mentor.name %></center>
      </p>


      <br>
      <br>
      <h3>Members <btn class="addmem" data-toggle="modal" data-target="#myModal">+ Add member</btn></h3>
      <br>
      <div class="row3">
        <% @group.users.each do |user| %>
          <div class="column3">
          <%= link_to " "+user.name, user, class: "fa fa-user memname " %>
          <% if policy(@group).admin_access? %>
              <%= link_to 'Remove', group_member_path(GroupMember.find_by(user_id:user.id,group_id:@group.id)), method: :delete, data: { confirm: 'Are you sure?' }, class:"removerel" %>
              <% end %>
          <br>
          <%= user.email %>
          </div>
          <% end %>
          
      </div>
      <div id="myModal" class="modal fade" role="dialog">
        <div class="modal-dialog">

          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Add members</h4>
              <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
              <p>Enter Email IDs separated by commas/spaces or in separate lines. If users are not registered, an email ID will be sent requesting them to sign up.</p>
              <%= form_with(model: @group_member, local: true) do |form| %>
                  <% if @group_member.errors.any? %>
                      <div id="error_explanation">
                        <h2><%= pluralize(group_member.errors.count, "error") %> prohibited this group_member from being saved:</h2>

                        <ul>
                          <% @group_member.errors.full_messages.each do |message| %>
                              <li><%= message %></li>
                          <% end %>
                        </ul>
                      </div>
                  <% end %>

                  <div class="field">
                    <%= form.hidden_field :group_id, id: :group_member_group_id %>
                  </div>

                  <div class="form-group">
                    <label for="Email Ids">Email IDs:</label>
                    <textarea class="form-control" rows="5" id="emails" name="group_member[emails]"></textarea>
                  </div>

                  <div class="actions modal-footer">
                    <%= form.submit "Add members", class: 'btn btn-secondary' %>
                  </div>
              <% end %>
            </div>
            <!--<div class="modal-footer">-->
              <!--<button type="button" class="btn btn-secondary" data-dismiss="modal">close</button>-->
            <!--</div>-->
          </div>

        </div>
      </div>

      <% if policy(@group).admin_access? %>

            <br>
            <br>
            <h3>Assignment
            <%= link_to 'Add new assignment', new_group_assignment_path(@group), class: "addmem" %></h3>
          <br>
          <br>
      <%end%>


      <table class="table" style="border-collapse: collapse; border-spacing: 0 1em; ">
        <thead>
        <tr>
          <th>Name</th>
          <th>DeadLine</th>
          <th>Grading</th>
          
          <th>Actions</th>
          <% unless policy(@group).admin_access? %>
            <th>Grade</th>
          <% end %>
        </tr>
        </thead>

        <tbody>
        <tbody>
        <% @group.assignments.includes(projects: :grade).each do |assignment| %>
            <tr class="arows" >
              <td><%= assignment.name %></td>
              <td><div class="date"><%= assignment.deadline.strftime("%d %b,%Y %I:%M %p %Z") %></div>
                <% if(assignment.deadline > Time.now) %>
                <p> <strong>Time remaining: </strong><%=(( assignment.deadline.to_i - Time.now.to_i)/1.day)%> days,  <%=(( assignment.deadline.to_i- Time.now.to_i)/1.hour)%24%> hours, <%=(( assignment.deadline.to_i- Time.now.to_i)/1.minute)%60%> minutes</p>
                <% end %>
              </td>
              <td> <%= AssignmentDecorator.new(assignment).graded %> </td>
              
              <td>
                <% if policy(@group).admin_access? %>
                  <%= link_to 'View', group_assignment_path(@group,assignment), class:"view" %>
                  <% if assignment.status!="closed" %>
                    <%= link_to 'Edit', edit_group_assignment_path(@group,assignment), class:"EditReopen" %>
                  <% else %>
                    <%= link_to 'Reopen', reopen_group_assignment_path(@group,assignment), class:"EditReopen" %>
                  <% end %>
                  <%= link_to 'Delete', group_assignment_path(@group,assignment),class:"del", method: :delete, data: { confirm: 'Are you sure?' } %>
                <% else %>

                    <% project_assignment = assignment.projects.find { |p| p.author_id == current_user.id } %>

                    <% if(assignment.deadline > Time.now) %>
                        <% if project_assignment.nil?%>
                            <%= link_to 'Start Working', assignment_start_path(@group,assignment) %>
                        <% else %>
                            <%= link_to 'View your work', user_project_path(current_user,project_assignment) %>
                        <% end %>
                    <% else %>
                        <% if project_assignment.nil?%>
                            Not submitted!
                        <% else %>
                            <%= link_to 'View your submission', user_project_path(current_user,project_assignment) %>
                        <% end %>
                    <% end %>

              <% end %>


              </td>
              <% unless policy(@group).admin_access? %>
                <td>
                  <% if policy(assignment).show_grades? && project_assignment.present? %>
                    <div class="tooltip-help">
                      <%= ProjectDecorator.new(project_assignment).grade_str %>
                      <div class="right-help">
                        <%= ProjectDecorator.new(project_assignment).remarks_str %>
                        <i> </i>
                      </div>
                    </div>
                  <% else %>
                    N.A.
                  <% end %>
                </td>
              <% end %>
            </tr>
        <% end %>
        </tbody>
      </table>
      <% if policy(@group).admin_access? %>      
      <% end %>
      <%= link_to 'Back', user_groups_path(current_user) ,class:"back" %>
    </div>
  </div>
  <br />
  <br />
  <script>
      $(document).ready(function() {

          $('.date').each(function(){
              this.innerHTML = formatDate(new Date(this.innerHTML), "dddd hh:mmTT zz, dd MMM yyyy")
          })
      })
  </script>

</div>

