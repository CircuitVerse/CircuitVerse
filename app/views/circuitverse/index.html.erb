<script>
  $(document).ready(function(){
    $("#alertdiv").delay(5000).fadeOut(600);
  });
</script>
<% content_for :title, t("circuitverse.index.title") %>
<% set_meta_tags twitter: {
                   card: "summary_large_image",
                   title: yield(:title),
                   description: Rails.configuration.site_description,
                   image: {
                     src: "#{Rails.configuration.site_url}img/circuitverseBanner2.png",
                   },
                 } %>
<% set_meta_tags og: {
                   title: yield(:title),
                   image: "#{Rails.configuration.site_url}img/circuitverseBanner2.png",
                   description: Rails.configuration.site_description,
                   type: "article",
                   site_name: Rails.configuration.site_name,
                 } %>
<% if notice %>
  <div class="row" id='alertdiv'>
    <div class="alert alert-success alert-dismissible container text-center">
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="<%= t('close', default: 'Close') %>"></button>
      <h6><%= notice %></h6>
    </div>
  </div>
<% end %>
<%= render "announcements/announcement" %>
<div class="container">
  <div class="d-flex justify-content-center justify-content-lg-between">
    <div class="home-main-content d-flex flex-column gap-3 align-items-center align-items-lg-start text-center text-lg-start">
      <%= render Home::BadgeComponent.new(text: t("circuitverse.index.free_and_open_source")) %>
      <h1 class="m-0"><%= sanitize(t("circuitverse.index.main_heading_html")) %></h1>
      <p class="m-0"><%= t("circuitverse.index.main_description") %></p>
      <div class="d-flex flex-column flex-sm-row gap-4">
        <a class="home-primary-button" href="/simulator"><%= t("launch_simulator") %>
          <%= image_tag "SVGs/arrowRight.svg", alt: "", class: "ms-2", aria: { hidden: true } %>
        </a>
        <a href="https://learn.circuitverse.org/" target="_blank" rel="noopener noreferrer" class="home-secondary-button"><%= t("circuitverse.index.explore_tutorials") %></a>
        <% if Flipper.enabled?(:circuit_explore_page, current_user) %>
          <a class="home-secondary-button" href="/explore"><%= t("circuitverse.index.explore_circuits") %></a>
        <% end %>
      </div>
      <div class="d-flex gap-2">
        <a class="home-link" href="/teachers"><%= t("circuitverse.index.for_teachers") %></a>
        <span class="green-dot">&bull;</span>
        <a class="home-link" href="/contribute"><%= t("circuitverse.index.for_contributors") %></a>
      </div>
    </div>
    <%= image_tag "homepage/new_homepage_sketch.png", alt: t("circuitverse.index.home_hero_image_alt"), class: "home-image-cover" %>
  </div>
  <div class="stats-section d-flex flex-column gap-4 my-5 py-5 rounded-4 w-100 align-items-center">
    <div class="d-flex flex-column text-center align-items-center gap-2">
      <%= render Home::BadgeComponent.new(text: t("circuitverse.index.stats.badge_content"), should_show_dot: false) %>
      <h2 class="fw-bold"><%= t("circuitverse.index.stats.heading") %></h2>
      <p class="stats-description"><%= t("circuitverse.index.stats.description") %></p>
    </div>
    <div class="stats-grid">
      <%= render Home::StatCardComponent.new(number: @stats[:circuits_count], label: t("circuitverse.index.stats.circuits_created")) %>
      <%= render Home::StatCardComponent.new(number: @stats[:users_count], label: t("circuitverse.index.stats.users")) %>
      <%= render Home::StatCardComponent.new(number: @stats[:universities_count], label: t("circuitverse.index.stats.universities")) %>
      <%= render Home::StatCardComponent.new(number: @stats[:countries_count], label: t("circuitverse.index.stats.countries")) %>
    </div>
  </div>
  <div class="d-flex flex-column gap-4 m-4 mb-0 align-items-center">
    <div class="d-flex flex-column text-center align-items-center gap-2">
      <%= render Home::BadgeComponent.new(text: t("circuitverse.index.features.badge_content"), should_show_dot: false) %>
      <h2 class="fw-bold"><%= t("circuitverse.index.features.everything_you_need_heading") %></h2>
      <p class="features-description"><%= t("circuitverse.index.features.main_description") %></p>
    </div>
    <div class="feature-card-grid">
      <% @features.each do |feature| %>
        <%= render Home::FeatureCardComponent.new(
          image_path: feature[:image_path],
          alt_text: feature[:alt_text],
          title: t(feature[:title_key]),
          description: t(feature[:description_key])
        ) %>
      <% end %>
    </div>
  </div>
</div>

<div class="container">
  <div class="row center-row home-circuit-card-row">
    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
      <h3><%= t("circuitverse.index.featured_examples.main_heading") %></h3>
      <p><%= t("circuitverse.index.featured_examples.main_description") %></p>
    </div>
  </div>
  <div class="row center-row justify-content-center">
    <div class="col-12 col-sm-12 col-md-6 col-lg-4">
      <div class="card circuit-card">
        <%= image_tag "homepage/rippleCarry.jpg", alt: "Ripple Carry", class: "card-img-top circuit-card-image examples-circuit-card-image" %>
        <div class="card-footer circuit-card-footer">
          <div class="circuit-card-name">
            <p><%= t("circuitverse.index.featured_examples.circuit1_text") %></p>
            <span class="tooltiptext"><%= t("circuitverse.index.featured_examples.circuit1_text") %></span>
          </div>
          <a class="btn primary-button circuit-card-primary-button" target="_blank" href="https://circuitverse.org/users/3/projects/248"><%= t("view") %></a>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-12 col-md-6 col-lg-4">
      <div class="card circuit-card">
        <%= image_tag "homepage/sap.jpg", alt: "SAP-1", class: "card-img-top circuit-card-image examples-circuit-card-image" %>
        <div class="card-footer circuit-card-footer">
          <div class="circuit-card-name">
            <p><%= t("circuitverse.index.featured_examples.circuit2_text") %></p>
            <span class="tooltiptext"><%= t("circuitverse.index.featured_examples.circuit2_text") %></span>
          </div>
          <a class="btn primary-button circuit-card-primary-button" target="_blank" href="https://circuitverse.org/users/3/projects/67"><%= t("view") %></a>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-12 col-md-6 col-lg-4">
      <div class="card circuit-card">
        <%= image_tag "homepage/fullAdder.jpg", alt: "Full Adder", class: "card-img-top circuit-card-image examples-circuit-card-image", height: "180", width: "288" %>
        <div class="card-footer circuit-card-footer">
          <div class="circuit-card-name">
            <p><%= t("circuitverse.index.featured_examples.circuit3_text") %></p>
            <span class="tooltiptext"><%= t("circuitverse.index.featured_examples.circuit3_text") %></span>
          </div>
          <a class="btn primary-button circuit-card-primary-button" target="_blank" href="https://circuitverse.org/users/3/projects/247"><%= t("view") %></a>
        </div>
      </div>
    </div>
  </div>
  <div class="row center-row">
    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
      <a class="btn primary-button homepage-primary-button-feature" href="<%= Flipper.enabled?(:circuit_explore_page, current_user) ? explore_path : '/examples' %>"><%= t("circuitverse.index.explore_more") %></a>
    </div>
  </div>
</div>

<div class="container-fluid home-container-fluid">
  <div class="container">
    <div class="row center-row">
      <div class="col-12 col-sm-12 col-md-12 col-lg-12">
        <h3><%= t("circuitverse.index.editor_picks.main_heading") %></h3>
        <p><%= t("circuitverse.index.editor_picks.main_description") %></p>
      </div>
    </div>
    <% cache :featured_circuits, expires_in: 6.hours do %>
      <div class="row center-row justify-content-center">
        <% @featured_circuits.each do |circuit| %>
          <div class="col-12 col-sm-12 col-md-6 col-lg-4">
            <div class="card circuit-card">
              <%= image_tag(
                    circuit.circuit_preview.attached? ? circuit.circuit_preview : image_path("empty_project/default.png"),
                    alt: circuit.name,
                    class: "card-img-top circuit-card-image",
                    height: "180",
                    width: "288"
                  ) %>
              <div class="card-footer circuit-card-footer">
                <div class="circuit-card-name">
                  <p><%= circuit.name %></p>
                  <span class="tooltiptext"><%= circuit.name %></span>
                </div>
                <a class="btn primary-button circuit-card-primary-button" target="_blank" href="<%= user_project_url(circuit.author, circuit) %>"><%= t("view") %></a>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
    <div class="row center-row">
      <div class="col-12 col-sm-12 col-md-12 col-lg-12">
        <a class="btn primary-button homepage-primary-button-feature" href="<%= Flipper.enabled?(:circuit_explore_page, current_user) ? explore_path : '/featured_circuits' %>"><%= t("circuitverse.index.explore_more") %></a>
      </div>
    </div>
  </div>
</div>

<% cache "recent-projects-#{params[:after]}-#{params[:before]}", expires_in: 10.minutes do %>
  <div class="container" id="recent">
    <div class="row center-row home-circuit-card-row">
      <div class="col-12 col-sm-12 col-md-12 col-lg-12">
        <h3><%= t("circuitverse.index.recent_circuits.main_heading") %></h3>
        <p><%= t("circuitverse.index.recent_circuits.main_description") %></p>
      </div>
    </div>
    <div class="row center-row justify-content-center">
      <% @projects.each do |project| %>
        <div class="col-12 col-sm-12 col-md-6 col-lg-4">
          <div class="card circuit-card">
            <%= image_tag(
                  project.circuit_preview.attached? ? project.circuit_preview : image_path("empty_project/default.png"),
                  alt: project.name,
                  class: "card-img-top circuit-card-image"
                ) %>
            <div class="card-footer circuit-card-footer">
              <div class="circuit-card-name">
                <p><%= project.name %></p>
                <span class="tooltiptext"><%= project.name %></span>
              </div>
              <a class="btn primary-button circuit-card-primary-button" target="_blank" href="<%= user_project_url(project.author, project) %>"><%= t("view") %></a>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    <div class="container pagination-cont">
      <div class="pagination justify-content-center">
        <% if @projects_page.has_previous? %>
          <%= link_to t("previous"), root_path(before: @projects_page.previous_cursor, anchor: "recent"), class: "page-link" %>
        <% end %>
        <% if @projects_page.has_next? %>
          <%= link_to t("next"), root_path(after: @projects_page.next_cursor, anchor: "recent"), class: "page-link" %>
        <% end %>
      </div>
    </div>
  </div>
<% end %>

<% if user_signed_in? %>
  <script>
    if(localStorage.getItem("recover_login")){
        window.location.href = "/simulator"
    }
  </script>
<% end %>
<script type="application/ld+json">
  {
    "@context" : "http://schema.org",
    "@type" : "WebApplication",
    "name" : "<%= Rails.configuration.site_name %>",
    "image" : "<%= Rails.configuration.site_image %>",
    "url" : "<%= Rails.configuration.site_url %>",
    "applicationCategory" : "<%= Rails.configuration.site_category %>",
    "downloadUrl" : "<%= Rails.configuration.site_download_url %>",
    "operatingSystem": "All"
  }
</script>
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "url" : "<%= Rails.configuration.site_url %>",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "<%= Rails.configuration.site_url %>/search?resource=Projects&q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
</script>
<!-- Bootstrap core JavaScript
    ================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
