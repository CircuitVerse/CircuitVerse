<html>
  <head>
    <title>CircuitVerse - Digital Circuit Simulator</title>
    <link rel="icon" href="/img/favicon.ico">

    <!-- Styles -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <%= stylesheet_link_tag 'simulator', media: 'all', 'data-turbolinks-track': 'reload' %>

    <!-- JavaScript -->
    <script>
        userSignedIn = <%= user_signed_in? %>;
        logix_project_id = <%= @logix_project_id %>;
        projectName = "<%= @projectName %>";
    </script>

    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <!-- Google Analytics -->
    <%= render "layouts/google_analytics" %>

    <%= csrf_meta_tags %>
  </head>

  <body>
    <!--Displays the loading screen  -->
    <script src="/js/pace.js"></script>

    <div>
      <nav class="navbar navbar-expand-lg toolbar navbar-dark bg-dark">
        <a class="navbar-brand" href="/">CircuitVerse</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="navbar-nav mr-auto noSelect pointerCursor" id="toolbar">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Project<span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li class="toolbarButton logixButton" id="newProject"><a>New Project</a></li>
                <li class="toolbarButton logixButton" id="clearProject"><a>Clear Project</a></li>
                <li class="toolbarButton logixButton" id="save"><a>Save Online</a></li>
                <li class="toolbarButton logixButton" id="saveOffline"><a>Save Offline</a></li>
                <li class="toolbarButton logixButton" id="createOpenLocalPrompt"><a>Open Offline</a></li>
                <li class="toolbarButton logixButton" id="recoverProject"><a>Recover project</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Circuit<span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li class="toolbarButton logixButton" id="newCircuit"><a>New Circuit +</a></li>
                <li class="toolbarButton logixButton" id="createSubCircuitPrompt"><a>Insert SubCircuit</a></li>
              </ul>
            </li>

          </li>

          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tools<span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li class="toolbarButton logixButton" id="createCombinationalAnalysisPrompt"><a>Combinational Analysis</a></li>
              <li class="toolbarButton logixButton" id="startPlot"><a>Start Plot</a></li>
              <li class="toolbarButton logixButton" id="createSaveAsImgPrompt"><a>Download Image</a></li>
            </ul>
          </li>

          <li class="">
            <a href="https://docs.circuitverse.org" target="_blank" role="button" aria-haspopup="true" aria-expanded="false">Help</a>
          </li>
        </ul>

        <span class="projectName noSelect defaultCursor font-weight-bold" id="projectName">
          Untitled
        </span>

        <ul class="nav navbar-nav noSelect pointerCursor pull-right">
          <li class="dropdown pull-right">
            <% if user_signed_in? %>
              <a href="#" class="dropdown-toggle " data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><%= current_user.name %><span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li class="toolbarButton"><a href=<%= profile_path(current_user) %>>Profile</a></li>
                <li class="toolbarButton"><a href=<%= user_path(current_user) %>>My Circuits</a></li>
                <li class="toolbarButton"><a href=<%= user_groups_path(current_user) %>>My Groups</a></li>
                <div class="dropdown-divider"></div>
                <li class="toolbarButton"><a rel="nofollow" data-method="delete" href=<%= destroy_user_session_path %>>Sign out</a></li>
              </ul>
            <% else %>
              <a class="navbar-nav nav-link" href=<%= new_user_session_path %>>Sign in</a>
            <% end %>
          </li>
        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </nav>
    <div>
      <div class="left" id="sideBar" style="overflow-y: scroll;overflow-x: hidden">
        <div class="modules noSelect defaultCursor">
          <div id="modules-header">Circuit Elements</div>
          <div class="accordion" id="menu"></div>
        </div>

        <div class="moduleProperty effect1" id="moduleProperty">
          <div id="moduleProperty-title" class="noSelect pointerCursor">Properties</div>
          <div id="moduleProperty-inner"></div>
        </div>
      </div>

      <div class="rightPanel">
        <div id="tabsBar" class="noSelect pointerCursor"></div>

        <div class="simulation" id="simulation">
          <div id="restrictedDiv" class="alert alert-danger display-none">
        </div>

        <% if @project&.assignment_id.present? && @project&.assignment&.elements_restricted? %>
          <div id="restrictedElementsDiv" class="alert alert-danger">
            <div> Restricted elements used: <span id="restrictedElementsDiv-list"> </span></div>
          </div>
        <% end %>

        <div id="message-div"></div>

        <div id="canvasArea">
          <canvas id="backgroundArea" style="position: absolute; left: 0; top: 0; z-index: 0; width:100%;height:100%"></canvas>
          <canvas id="simulationArea" style="position: absolute; left: 0; top: 0; z-index: 1; width:100%;height:100%"></canvas>

          <div id="plot">
            <canvas id="plotArea" style="position: absolute; left: 0; top: 0; z-index: 2"></canvas>
          </div>

          <div id="miniMap">
            <canvas id="miniMapArea" style="position: absolute; left:0; top: 0; z-index: 3;"></canvas>
          </div>

          <div id="contextMenu" oncontextmenu="return false;">
            <ul>
              <li onclick="menuItemClicked(2)"><a>Paste</a></li>
              <li onclick="menuItemClicked(0)"><a>Copy</a></li>
              <li onclick="menuItemClicked(1)"><a>Cut</a></li>
              <li onclick="menuItemClicked(3)"><a>Delete</a></li>
              <li onclick="menuItemClicked(4)"><a>Undo</a></li>
              <li onclick="menuItemClicked(5)"><a>New Circuit</a></li>
              <li onclick="menuItemClicked(6)"><a>Insert SubCircuit</a></li>
              <li onclick="menuItemClicked(7)"><a>Center Focus</a></li>
            </ul>
          </div>

          <div id="help"></div>

          <div style="position:absolute; right:30px; top:30px; z-index:100">
            <button type="button" class="btn zoomButton btn-lg" onclick="changeScale(0.2,'zoomButton','zoomButton',2)">
              <span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span>
            </button>
          </div>

          <div class="sk-folding-cube loadingIcon" style="display:none;position:absolute; right:50%; bottom:50%; z-index:100">
            <div class="sk-cube1 sk-cube"></div>
            <div class="sk-cube2 sk-cube"></div>
            <div class="sk-cube4 sk-cube"></div>
            <div class="sk-cube3 sk-cube"></div>
          </div>

          <div style="position:absolute; right:60px; top:30px; z-index:100">
            <button type="button" class="btn zoomButton btn-lg" onclick="globalScope.centerFocus(false)">
              <span class="glyphicon glyphicon-screenshot" aria-hidden="true"></span>
            </button>
          </div>

          <div style="position:absolute; right:90px; top:30px; z-index:100">
            <button type="button" class="btn zoomButton btn-lg" onclick="changeScale(-0.2,'zoomButton','zoomButton',2)">
              <span class="glyphicon glyphicon-zoom-out" aria-hidden="true"></span>
            </button>
          </div>

          <div style="position:absolute; right:120px; top:30px; z-index:100">
            <button type="button" class="btn zoomButton btn-lg" onclick="undo()">
              <span class="glyphicon glyphicon-repeat" aria-hidden="true"></span>
            </button>
          </div>

          <div style="position:absolute; right:150px; top:30px; z-index:100">
            <button type="button" class="btn zoomButton btn-lg" onclick="delete_selected()">
              <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
            </button>
          </div>

          <div id="layoutDialog" style="display:none" title="Layout Options">
            <div class="container">
              <div class="panel-heading">Layout options</div>

              <div>
                Width:<button type="button" class="btn zoomButton btn-lg" onclick="decreaseLayoutWidth()">
                  <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>
                </button>
                <button type="button" class="btn zoomButton btn-lg" onclick="increaseLayoutWidth()">
                  <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                </button>
              </div>

              <div>
                Height:<button type="button" class="btn zoomButton btn-lg" onclick="decreaseLayoutHeight()">
                  <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>
                </button>
                <button type="button" class="btn zoomButton btn-lg" onclick="increaseLayoutHeight()">
                  <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                </button>
              </div>

              <div>
                Reset all nodes:
                <button type="button" class="btn zoomButton btn-lg" onclick="layoutResetNodes()">
                  <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span>
                </button>
              </div>

              <div>
                Title:
                <button type="button" class="btn zoomButton btn-lg" onclick="layoutTitleUp()">
                  <span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span>
                </button>
                <button type="button" class="btn zoomButton btn-lg" onclick="layoutTitleDown()">
                  <span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span>
                </button>
                <button type="button" class="btn zoomButton btn-lg" onclick="layoutTitleLeft()">
                  <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span>
                </button>
                <button type="button" class="btn zoomButton btn-lg" onclick="layoutTitleRight()">
                  <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span>
                </button>
              </div>

              <div>
                <p>Title Enabled : <label class='switch'> <input type='checkbox' checked id="toggleLayoutTitle" onclick="toggleLayoutTitle()"> <span class='slider'></span> </label></p>
              </div>

              <div>
                Save:
                <button type="button" class="btn zoomButton btn-lg" onclick="saveLayout()">
                  <span class="glyphicon glyphicon glyphicon-ok" aria-hidden="true"></span>
                </button>
                Cancel:
                <button type="button" class="btn zoomButton btn-lg" onclick="cancelLayout()">
                  <span class="glyphicon glyphicon glyphicon-remove" aria-hidden="true"></span>
                </button>
              </div>

            </div>
          </div>
        </div>
      </div>

      <div id="combinationalAnalysis" style="display:none;" title="BooleanLogicTable"></div>
      <div id="insertSubcircuitDialog" style="display:none;" title="Insert SubCircuit"></div>
      <div id="openProjectDialog" style="display:none;" title="Open Project"></div>
    </div>

    <!-- Right panel -->
    <div id="saveImageDialog" style="display:none;" title="Render Image">
      <p>
        <label class="option inline"><input type="radio" name="imgType" value="png" checked="checked">PNG</label>
        <label class="option inline"><input type="radio" name="imgType" value="jpeg">JPEG</label>
        <label class="option inline"> <input type="radio" name="imgType" value="svg">SVG</label>
        <label class="option inline"> <input type="radio" name="imgType" value="bmp">BMP</label>
        <label class="option inline"> <input type="radio" name="imgType" value="gif">GIF</label>
        <label class="option inline"> <input type="radio" name="imgType" value="tiff">TIFF</label>
      </p>

      <p>
        <label class="option inline"><input type="radio" name="view" value="full">Full Circuit View</label>
        <label class="option inline"> <input type="radio" name="view" value="current" checked="checked">Current View</label>
      </p>

      <p>
        <label class="option inline"><input type="checkbox" name="transparent" value="transparent">Transparent Background</label>
      </p>

      <p>
        Resolution:
        <label class="option inline"><input type="radio" name="resolution" value="1" checked="checked">1x</label>
        <label class="option inline"><input type="radio" name="resolution" value="2">2x</label>
        <label class="option inline"><input type="radio" name="resolution" value="4">4x</label>
      </p>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        setup()
      }, false);
      embed=false;

      <% if @project&.assignment_id.present? %>
        restrictedElements = JSON.parse('<%= raw @project&.assignment.restrictions %>');
      <% else %>
        restrictedElements = [];
      <% end %>
    </script>

    <!-- on hover for dropdowns -->
    <script>
      $('.dropdown-toggle').hover( function() {
          $('.dropdown.open').removeClass('open');
          $(this).parent('.dropdown').addClass('open');
      });
    </script>

    <% if @project.nil? or @project.assignment_id.nil? %>
      <script src="/js/combinationalAnalysis.js"></script>
      <script src="/js/Quin_McCluskey.js"></script>
    <% end %>
    <script type="text/javascript" src="/js/metadata.json"></script>
    <%= javascript_include_tag 'simulator/simulator-edit', 'data-turbolinks-track': 'reload' %>
  </body>
</html>
