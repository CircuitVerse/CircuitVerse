<div class="container feature">
  <div class="row">

    <div class="col">

      <p id="notice"><%= notice %></p>

      <p>
        <strong>Name:</strong>
        <%= @assignment.name %>
      </p>

      <p>
        <strong>Group:</strong>
        <%= @assignment.group.name %>
      </p>

      <p>
        <strong>Deadline:</strong>
        <div class="date">
          <%= @assignment.deadline.strftime("%d %b,%Y %I:%M %p %Z") %>
        </div>
        <% if(@assignment.deadline > Time.now) %>
          <p> <strong>Time remaining: </strong><%=(( @assignment.deadline.to_i - Time.now.to_i)/1.day)%> days,  <%=(( @assignment.deadline.to_i- Time.now.to_i)/1.hour)%24%> hours, <%=(( @assignment.deadline.to_i- Time.now.to_i)/1.minute)%60%> minutes</p>
      <% end %>
      </p>

      <p>
        <strong> Graded: </strong>
        <% if @assignment.graded? %>
          Graded(<%= @assignment.grading_scale %>)
        <% else %>
          Not Graded
        <% end %>
      </p>

      <p>
        <strong>Description:</strong>
        <p><%= @assignment.description&.html_safe%></p><br>
      </p>

      <%= link_to 'Back', group_path(@group) %>

      <%if policy(@assignment).admin_access? && @assignment.status!="closed"%>

          <%=link_to 'Edit', edit_group_assignment_path(@group,@assignment) %>

      <%end%>

      <%if policy(@assignment).can_export_grades? %>
        <%= link_to 'Export', grades_to_csv_path(@assignment, format: :csv) %>
      <%end%>

    </div>


  </div>
  <hr>
  <%if policy(@assignment).admin_access? %>
  <div class="row">

    <script>
        $( function() {
            $('.list-group-item-action').on('click', function (e) {
                e.preventDefault()
                $("#assignmentPreview").attr("src","/simulator/" + e.currentTarget.id );
                $(this).tab('show')
            })
        } );
    </script>

    <div class="col-3">
      <div class="overflow:scroll">
        <div class="list-group" id="list-tab" role="tablist" id="submissionTable" style="max-height:600px;overflow:hidden;overflow-y:scroll">
		  <% @project_order = @assignment.projects.includes(:grade, :author).sort_by {|p| p.author.name} %>
          <% @project_order.each do |project| %>
              <a class="list-group-item list-group-item-action" id=<%= project.id%> data-grade=<%= project.grade&.grade.present? ? project.grade&.grade : "N.A." %> ><%= project.author.name  %></a>
          <%end%>

        </div>
      </div>

    </div>
    <div class="col col-9">

      <div class="embed-responsive embed-responsive-4by3 feature">
        <iframe src="" id="assignmentPreview" scrolling="no" webkitAllowFullScreen mozAllowFullScreen allowFullScreen> </iframe>
      </div>
    </div>
  </div>

  <% if @assignment.graded? && @assignment.deadline - Time.now < 0 %>
    <div class="row grade-container">
      <div class="col-3">
        <span class="bold"> Enter Grade: </span>
        <span id="project-grade-error" class="error"></span>
        <div class = "grade-show-container">
          <span class="bold"> Grade: </span><span id="project-grade"> Select a project to view/add grade </span>
        </div>
      </div>
      <div class="col-9">
        <% unless @assignment.grades_finalized %>
          <%= form_with(model: Grade.new, multipart: true, id: "assignment-grade-form", url: "/grades") do |form| %>
            <%= form.hidden_field :project_id, id: "assignment-project-id" %>
            <%= form.hidden_field :assignment_id, value: @assignment.id %>
            <% if @assignment.grading_scale == "percent" %>
              <%= form.number_field :grade, id: "assignment-grade-grade", min: 0, max: 100 %>
            <% elsif @assignment.grading_scale == "letter" %>
              <%= form.text_field :grade, id: "assignment-grade-grade" %>
            <% end %>
            <div style="margin-top: 10px">
              <%= button_tag 'Submit', id: "grade-form-submit" %>
              <%= button_tag 'Remove', id: "grade-form-remove" %>
              <%= button_tag 'Finalize Grades', id: "grade-form-finalized", data: { url: group_assignment_path(@assignment.group, @assignment) } %>
            </div>
          <% end %>
        <% else %>
           Grades have been finalized!
        <% end %>
      </div>
    </div>
    <script src="/js/grading.js"> </script>
  <% end %>
  <%end%>

  <script src="/js/time.js"></script>
  <script>
      $(document).ready(function() {
          $('.date').each(function(){
              this.innerHTML = formatDate(new Date(this.innerHTML), "dddd hh:mmTT zz, dd MMM yyyy")
          })})
  </script>
</div>
