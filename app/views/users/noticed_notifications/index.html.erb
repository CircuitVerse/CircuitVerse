<% if @unread.empty? %>
  <% content_for :title, "Notifications" %>
<% else %>
  <% content_for :title, "(#{@unread.count}) Notifications" %>
<% end %>

<div class="container notification-container" data-controller="notifications">
  <h1 class="notification-heading"><%= t("users.notifications.heading") %></h1>
  <div class="d-flex justify-content-between mt-3">
    <div class="tab-container">
      <span id="all-notifications" class="active notifications-tab" data-action="click->notifications#activeAllNotifications"><%= t("users.notifications.all") %></span>
      <span id="unread-notifications" class="notifications-tab" data-action="click->notifications#activeUnreadNotifications"><%= t("users.notifications.unread") %></span>
      <span id="settings" class="notifications-tab" data-action="click->notifications#activeSettings">Settings</span>
    </div>
    <% if @unread.count.positive? %>
      <div>
        <%= link_to t("users.notifications.mark_as_read_button"), mark_all_as_read_url(current_user), :method=> :patch, class: "anchor-text" %>
      </div>
    <% end %>
  </div>
  <div id="all-notifications-div" class="d-flex flex-column bd-highlight mb-10 mt-3 notifications_container">
    <% @notifications.each do |notification| %>
      <%= link_to mark_as_read_path(id: current_user, notification_id: notification.id), method: :post, class: 'mb-2 mt-2 notification' do %>
        <div class="d-flex align-items-center notification-div">
          <span><i class="<%= notification.to_notification.icon %>"></i></span>
          <div class="d-flex flex-column message-wrapper">
            <% if notification.unread? %>
              <strong><span class="message"><%= notification.to_notification.message %></span></strong>
              <strong><span class="timestamp"><%= "#{time_ago_in_words(notification.created_at)} ago, #{notification.created_at.to_fs(:long)}" %></span></strong>
            <% else %>
              <span class="message"><%= notification.to_notification.message %></span>
              <span class="timestamp"><%= "#{time_ago_in_words(notification.created_at)} ago, #{notification.created_at.to_fs(:long)}" %></span>
            <% end %>
          </div>
          <% if notification.unread? %>
            <span class="unseen-active"></span>
          <% end %>
        </div>
      <% end %>
    <% end %>
    <% if @notifications.empty? %>
      <div class="col-12 row center-row">
        <div class="search-no-results-image">
          <%= image_tag "SVGs/noProject.svg", alt: "No result image" %>
          <h6><%= t("users.notifications.no_notifications") %></h6>
        </div>
      </div>
    <% end %>
  </div>
  <div id="unread-notifications-div" class="d-none flex-column bd-highlight mb-3 mt-3 notifications_container">
    <% @unread.each do |notification| %>
      <% if notification.unread? %>
        <%= link_to mark_as_read_path(id: current_user, notification_id: notification.id), method: :post, class: 'mb-2 mt-2 notification' do %>
          <div class="d-flex align-items-center">
            <span><i class="<%= notification.to_notification.icon %>"></i></span>
            <div class="d-flex flex-column message_wrapper">
              <strong><span class="message"><%= notification.to_notification.message %></span></strong>
              <strong><span class="timestamp"><%= "#{time_ago_in_words(notification.created_at)} ago, #{notification.created_at.to_fs(:long)}" %></span></strong>
            </div>
            <span class="unseen-active"></span>
          </div>
        <% end %>
      <% end %>
    <% end %>
    <% if @unread.empty? %>
      <div class="col-12 row center-row">
        <div class="search-no-results-image">
          <%= image_tag "SVGs/noProject.svg", alt: "No result image" %>
          <h6><%= t("users.notifications.no_unread_notifications") %></h6>
        </div>
      </div>
    <% end %>
  </div>
<hr>
<div id = "settings" class= "d-sett notification-settings">
  <div class = "" >
    <div>
      <h2 class="mb-2 mt-2 "><%= t("users.notifications.heading_settings") %></h2>
      <br>
    </div>
    <div>
        <% if @user.star && @user.fork == "true" %>
          <h6 class="mb-2 mt-2 "><%= t("users.notifications.disable_all") %></h6>
          <br>
          <%= link_to "disable all events" ,edit_notifications_path(params[:id], active: "true", count: "2"), method: :patch, class: 'notification danger-text' %>
        <% else %>
            <h6 class="mb-2 mt-2 "><%= t("users.notifications.enable_all") %></h6>
          <br>
            <%= link_to "enable all events" ,edit_notifications_path(params[:id], active: "false", count: "2"), method: :patch, class: 'notification anchor-text' %>
        <% end %>
        <br>
        <br>
        <br>
        </div>
    </div>
    <div>
        <h3 class="mb-2 mt-2 "><%= t("users.notifications.events_settings") %></h3>
        <hr>
      </div>
<%= fields_for @user ,:preferences do |w| %>
  <% @user.preferences.each do |key,value| %>
  <div class="container-fluid settings-fill-container-fluid">
    <div class="container">
      <div class="row center-row settings-center-content">
        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 settings-left-text">
          <h4><%= w.label key %></h4>
          <% if key == "star" %>
          <p><%= t("users.notifications.star_description") %></p>
          <% else %>
          <p><%= t("users.notifications.fork_description") %></p>
          <% end %>
        </div>
        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
        <br>
      &nbsp;
      &nbsp;
        <% if value == "true" %>
          <%= link_to "disable" ,edit_notifications_path(params[:id], type: key, active: value, count: "1"), method: :patch, class: 'notification danger-text' %>
        <% else %>
          <%= link_to "enable" ,edit_notifications_path(params[:id], type: key, active: value, count: "1"), method: :patch, class: ' notification anchor-text' %>
        <% end %>
        </div>
      </div>
    </div>
  </div>
<hr>
  <% end %>
<% end %>
  </div>
</div>
