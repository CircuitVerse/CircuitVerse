<div id="addmemberModal" class="modal fade" role="dialog">
  <div class="modal-dialog primary-modal-dialog">
    <div class="modal-content">
      <div class="modal-header primary-modal-header">
        <h4 class="modal-title"><%= t("add_members") %></h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
        <p><%= t("groups.add_member_description") %></p>
        <%= form_with(model: group_member, local: true) do |form| %>
          <% if group_member.errors.any? %>
            <div id="error-message">
              <ul>
                <% group_member.errors.full_messages.each do |message| %>
                    <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          <% end %>
          <div class="field">
            <%= form.hidden_field :group_id, id: :group_member_group_id %>
          </div>
          <div class="form-group">
            <%= form.label :emails %>
            <%= form.text_area :emails, id: :group_member_emails, rows: 4, class: 'form-control form-input', autofocus: true %>
          </div>
          <div class="modal-footer">
            <%= form.submit  class: 'btn primary-button' %>
        </div>
        <div class="row projects-views-count-container noSelect">
          <i class="fas fa-star projects-star-count-icon" aria-hidden="true"></i>
          <span id="star-count" class="noSelect"><%= @project.stars.count %></span>
           <%= t("projects.stars_count") %>
          &nbsp; &nbsp;
          <i class="fa fa-eye" aria-hidden="true"></i>
          <span id="star-count" class="noSelect"><%= @project.view %></span>
           <%= t("projects.views_count") %> &nbsp; &nbsp;
        </div>
        <div class="row center-row projects-user-details-container">
          <div class="projects-search-tags-container">
            <% if !@project.tags.empty? %>
              <% @project.tags.each do |tag| %>
                <%= link_to tag.name, tag_path(tag.name),class: "badge search-tag" %>
              <% end %>
            <% end %>
          </div>
          <p>
            <strong><%= t("projects.show.project_author") %> </strong>
            <%= link_to @project.author.name, @project.author, class: "anchor-text" %>
          </p>
          <% if !@project.forked_project.nil? %>
            <p>
              <strong><%= t("projects.show.project_forked_from") %> </strong>
              <%= link_to @project.forked_project.author.name+"/"+@project.forked_project.name, user_project_path(@project.forked_project.author,@project.forked_project), class: "anchor-text",method: :post %>
            </p>
          <% end %>
          <p>
            <strong><%= t("projects.show.project_access_type") %> </strong>
            <%= @project.project_access_type %>
          </p>
          <% if !@project.description.nil? %>
            <p>
              <strong><%= t("projects.show.project_description") %> </strong>
            </p>
            <div class="projects-details-description"><%= sanitize@project.description %></div>
          <% end %>
          <p title="<%= @project.created_at.strftime("%B %d, %Y, %l:%M %p UTC %:z") %>">
            <strong><%= t("projects.show.project_created_at") %> </strong>
            <% if @project.created_at >= 14.days.ago %>
              <%= time_ago_in_words(@project.created_at, include_seconds: true) + " ago" %>
            <% else %>
             <%= @project.created_at.strftime("%b %d, %Y") %>
            <% end %>
          </p>
          <p title="<%= @project.updated_at.strftime("%B %d, %Y, %l:%M %p UTC %:z") %>">
            <strong><%= t("projects.show.project_updated_at") %> </strong>
            <% if @project.updated_at >= 14.days.ago %>
              <%= time_ago_in_words(@project.updated_at, include_seconds: true) + " ago" %>
            <% else %>
              <%= @project.updated_at.strftime("%b %d, %Y") %>
            <% end %>
          </p>
          <% if user_signed_in? %>
            <p>
              <hr class="projects-horizontal-rule">
              <% if policy(@project).user_access? %>
                <a href="<%= simulator_edit_path(@project) %>" class="btn primary-button projects-primary-button" target="_blank"><%= t("launch_simulator") %></a>
              <% else %>
                <a class="btn primary-button projects-primary-button projects-others-embed-button" data-toggle="collapse" href="#collapseExample" aria-expanded="false" aria-controls="collapseExample" onclick="embedOther()">
                  <i class="fas fa-code"></i>
                  <span><%= t("projects.show.project_embed") %></span>
                </a>
              <% end %>
              <% if policy(@project).author_access? %>
                <%= link_to create_fork_project_path(@project), class: "btn primary-button projects-primary-button", method: :post do %>
                  <%= image_tag("SVGs/createCopy.svg", alt: "Create Copy") %>
                  <span><%= t("projects.show.project_copy") %></span>
                <% end %>
              <% else %>
                  <%= link_to create_fork_project_path(@project), class: "btn primary-button projects-primary-button", method: :post do %>
                  <%= image_tag("SVGs/forkProject.svg", alt: "Fork Project") %>
                  <span><%= t("fork") %></span>
                <% end %>
              <% end %>
              <% if @project.stars.exists?(user_id: current_user.id) %>
                <i id="toggleStarButton" class="fas fa-star btn primary-button projects-primary-button projects-button-star-icon" aria-hidden="true" onclick="toggleStar()"></i>
              <% else %>
                <i id="toggleStarButton" class="far fa-star btn primary-button projects-primary-button projects-button-star-icon" aria-hidden="true" onclick="toggleStar()"></i>
              <% end %>
            </p>
          <% end %>
          <% if policy(@project).author_access? %>
            <p>
              <a href="#" class="anchor-text" id="<%= @project.id %>" data-toggle="modal" data-target="#collaboratorModal"><%= t("projects.show.project_collaborator_add") %></a>
            </p>
          <% end %>
          <% if policy(@project).user_access? %>
            <hr class="projects-horizontal-rule">
            <p>
              <%= link_to edit_user_project_path(@author, @project), class: "btn secondary-button" do %>
                <%= image_tag("SVGs/editProject.svg", alt: "Edit Project") %>
                <span><%= t("edit") %></span>
              <% end %>
              <%= link_to "#", class: "btn secondary-button", data: {toggle: "modal", target: "#deleteprojectModal", currentauthor: @author.id, currentproject: @project.id} do %>
                <%= image_tag("SVGs/deleteProject.svg", alt: "Delete Project") %>
                <span><%= t("delete") %></span>
              <% end %>
              <a class="btn secondary-button projects-self-embed-button" data-toggle="collapse" href="#collapseExample" aria-expanded="false" aria-controls="collapseExample" onclick="embedSelf()">
                <i class="fas fa-code"></i>
                <span><%= t("projects.show.project_embed") %></span>
              </a>
            </p>
          <% end %>
          <div class="collapse" id="collapseExample">
            <div class="projects-embed-text-container">
              <label for="embedTextArea"></label>
              <textarea id="embedTextArea" class="projects-embed-text" rows="4" cols="35"><iframe width="600px" height="400px" src="<%= simulator_embed_url(@project) %>" id="projectPreview" scrolling="no" webkitAllowFullScreen mozAllowFullScreen allowFullScreen></iframe></textarea>
            </div>
            <small class="projectshow-embed-text-confirmation"><%= t("projects.show.copied_to_clipboard") %></small>
          </div>
        <% end %>
      </div>
      <div class="mx-auto text-center p-3">
        <p><%= t("or_use") %></p>
        <%= button_to generate_token_group_path,{remote: true,method: :put,class: 'btn primary-button', 'data-toggle':'collapse', 'href':'#collapseExample', 'aria-expanded':'false', 'aria-controls':'collapseExample', id: "clipboard_b"} do %>
        <p><%= t("groups.use_alternative") %></p>
        <%= button_to generate_token_group_path,{remote: true,method: :put,class: 'btn primary-button', 'data-toggle':'collapse', 'href':'#collapseExample', 'aria-expanded':'false', 'aria-controls':'collapseExample'} do %>
          <i class="fas fa-external-link-alt"></i>
          <span><%= t("groups.invite_link_btn") %></span>
        <% end %>
        <div class="collapse" id="collapseExample">
          <textarea id="embedInviteLink" class="group-invite-link-text" rows="4" cols="35"></textarea>
          <small class="embed-text-confirmation"><%= t("copied_to_clipboard") %></small>
        </div>
      </div>
    </div>
  </div>
  <br>
  <% collaborators = @project.collaborators %>
    <% if collaborators.count!=0 %>
      <div class="row center-row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
          <div class="projects-collaborators-container">
            <div class="row center-row">
              <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 projects-collaborators-heading">
                <div class="">
                  <%= t("projects.show.collaborators") %>
                </div>
              </div>
            </div>
            <% @project.collaborators.each do |user| %>
              <div class="row center-row">
                <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
                  <div class="projectshow-collaborators-userdata">
                    <%= link_to user.name, user, class: "anchor-text" %>
                  </div>
                </div>
                <% if policy(@project).author_access? %>
                  <div class="col-xs-8 col-sm-8 col-md-5 col-lg-5">
                    <div class="projects-collaborators-data">
                      <%= user.email %>
                    </div>
                  </div>
                  <div class="col-xs-4 col-sm-4 col-md-3 col-lg-3">
                    <div class="projects-collaborators-button-container">
                      <%= link_to "#", data: {toggle: "modal", target: "#deletecollaborationModal", currentcollaboration: Collaboration.find_by(user_id:user.id, project_id:@project.id).id }, class: "btn primary-delete-button" do %>
                        <%= image_tag("SVGs/deleteGroup.svg", alt: "Delete Collaboration") %>
                        <span><%= t("remove") %></span>
                      <% end %>
                    </div>
                  </div>
                <% end %>
                <hr class="projects-collaborators-horizontal-rule">
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>

    <%= render partial: "add_collaborator_modal" %>
    <%= render partial: "delete_project_confirmation_modal" %>
    <%= render partial: "delete_collaboration_confirmation_modal" %>
</div>
<script>
document.getElementById('clipboard_b').addEventListener("click", copy_to_clipboard);
function copy_to_clipboard(){
  setTimeout(function(){
    $("#embedInviteLink").select();
    document.execCommand("copy")
  },1000);
}
</script>
